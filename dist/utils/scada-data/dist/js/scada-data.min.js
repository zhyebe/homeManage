/*! scada-data 2015-12-24 */
$(function(){var a="ws://"+document.URL.substr(7).split("/")[0];alert(a),window.socket=io.connect(a);var b=Backbone.Model.extend({urlRoot:"scada",noIoBind:!1,socket:window.socket,initialize:function(){_.bindAll(this,"serverChange","serverDelete","modelCleanup"),this.noIoBind||(this.ioBind("update",this.serverChange,this),this.ioBind("delete",this.serverDelete,this))},serverChange:function(a){alert("serverChange"),this.set(a)},serverDelete:function(a){alert("serverDelete"),alert(a)},modelCleanup:function(a){alert("modelCleanup"),alert(a)},defaults:{Red:!1,Green:!0,Yellow:!1,Turn:!1,ReverseRed:!0,ReverseGreen:!1,ReverseYellow:!1,ReverseTurn:!1}}),c=1,d=2,e=3,f=Backbone.Model.extend({urlRoot:"scada",noIoBind:!1,socket:window.socket,initialize:function(){},defaults:{CtrlMode:c}});LaneIndicatorView=Backbone.View.extend({tagName:"div",events:{},initialize:function(){this.$el.append('<input id="testc"/>'),this.$("#testc").val("normal"),this.model.on("change",this.onChange,this),this.model.fetch()},render:function(){return this},onChange:function(a){alert(JSON.stringify(a.toJSON())),a.get("Green")&&a.get("ReverseRed")?this.$("#testc").val("normal"):a.get("Red")&&a.get("ReverseGreen")?this.$("#testc").val("reverse"):a.get("Red")&&a.get("ReverseRed")&&this.$("#testc").val("closed")}}),AppView=Backbone.View.extend({el:"body",events:{"click #test":"test","click #laneNormal":"laneNormal","click #laneReverse":"laneReverse","click #laneClosed":"laneClosed"},initialize:function(){var a=new b({id:"888888888000201015001"});this.view=new LaneIndicatorView({model:a}),this.$el.append(this.view.render().el),this.ctrlModel=new f({id:a.id+".ctrl"})},render:function(){return this},test:function(){},laneNormal:function(){this.ctrl(c)},laneReverse:function(){this.ctrl(d)},laneClosed:function(){this.ctrl(e)},ctrl:function(a){this.ctrlModel.set("CtrlMode",a),this.ctrlModel.save()}});new AppView});